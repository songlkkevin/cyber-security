# Homework 5
<p align=right><b>宋林恺 PB21051079</b></p>
<p align=right><b>罗胤玻 PB21111627</b></p>

## Traveling the Silk Road: A measurement analysis of a large anonymous online marketplace

### Background
- **Silk Road：** 使用Tor hidden service的匿名国际在线市场，并使用比特币作为交易货币，交易内容大多是受控物品，如毒品、枪支等。
- 文章通过收集6个月内的数据，对Silk Road进行了大规模的测量分析，包括用户、商品、交易等方面。
- 文章的贡献有：
  - 设计了简单的收集方法来获取公开的Silk Road数据。
  - 对商品、卖家、买家、交易等方面的数据进行了收集
  - 对Silk Road的规模、活动、用户行为、发展趋势等进行了分析

### Silk Road 介绍
以下主要介绍了Silk Road（SR）的运行方式与访问流程：
1. 客户在本地安装Tor客户端，或使用Tor的网络代理
   1. 注意Silk Road 仅作为 Tor 隐藏服务运行。也就是说，丝绸之路没有将 DNS 名称映射到已知的 IP 地址，而是使用基于伪顶级域名 .onion 的 URL，该域名只能通过 Tor 解析
   2. Tor 节点会在 Tor 网络内设置一个会合点，以便客户端和服务器可以相互通信，同时保持观察者和彼此未知的 IP 地址。
2. 客户注册或登录账号，然后浏览SR的公开列表（也存在商家的隐私列表）
3. 客户利用比特币的分布式支付系统进行支付，同时卖家和买家都被要求使用托管系统（即SR）进行支付
4. 为了保证匿名性，丝绸之路使用与买家住所不同的送货地址。一旦卖家发货，买家的收货地址就会从记录中删除。
5. SR也提供多虚拟中介服务来增强交易的匿名性

### 数据收集机制
作者使用爬虫来获取数据，需要特别提出的点是用于身份验证的cookie可以重复使用长达一周，因此通过每周至少进行一次手动cookie刷新，可以绕过CAPTCHA机制进行爬虫，来获取网站的内容并且为了防止运营者发现，作者定期丢弃和建立新的Tor电路进行爬虫，并在随机时间进行爬虫。另外，爬取数据期间，运营者似乎也做出了相应的措施，如：放弃交易反馈时间戳。虽然在用户的要求下返场，但是也导致了部分时间数据的不完整性。由于隐形列表的存在，作者无法获取到所有的商品信息，只能通过公开列表的数据对SR进行一定的分析。

### 市场特征
- 商品类型：大约有 220 个不同的类别，从数字商品到各种麻醉品或处方药。所有产品中，超过三分之二属于前 20 个类别之一。大麻是丝绸之路上最受欢迎的商品，其次是毒品。同时物品售出很快，一般在三周内
- 卖家：由于匿名性，不能获取卖家的真实信息，但是通过对卖家数量的分析来看，活跃卖家的数量一直在持续增加并且几乎呈线性增长。同时，卖家的留存率相当稳定，基本上在场时间100天内。
- 地点：大多数商品来自美国，远远多于排在第二位的英国，并且英语国家很多，SR的语言也是英语
- 客户满意度：SR上的反馈基本是正面的

### 经济影响
- 价格：SR以比特币作为交易货币，因此商品价格随着比特币的汇率变化而变化，但如果换算为美元或其他的较稳定的货币，商品价格波动不大，基本不会超过10%，并且有的大型卖家的行为与现实中的商家行为类似，如：提供折扣、欺诈等。
- 交易量：作者以29日为窗口进行了交易量的分析，观察到总交易量增长相当显著，最后稳定的交易量大约是7665比特币每日
- 佣金：经过统计分析，运营商平均佣金为产品价格的7.4%，平均每月收取约92,000美元的佣金

### 局限性和讨论
- 文章仅仅统计了公开列表的数据，无法获取到隐形列表的数据，因此各项数据均为下限。
- 文章的数据收集过程并不会为运营商或者个人产生被逮捕或起诉的风险
- 文章提出了四种干预策略：
  - 破坏网络：通过攻击Tor网络来破坏SR的匿名性，这是困难且影响很大的选择
  - 破坏金融基础设施：攻击比特币的使用
  - 破坏交付模式：加强对邮局和/或海关的控制，以防止非法物品被运送到目的地
  - 自由放任

### 总结
本文通过爬虫技术对SR公开交易进行了分析，揭示了SR的多种特点，并经过总结得出可以干预其运行的多种方法

## Many-shot Jailbreaking

由于OpenAI， DeepMind等部署的模型提供了更场的上下文窗口。论文中提出了一个通过将few-shot Jailbreaking 扩展为Many-shot Jailbreaking的大模型攻击方法。通过提供大量的违反大模型规定的上下文如欺骗，提供可能对人类有伤害的信息诱导大模型对之后的问题给出开发者并不想让其给出的答案。从而使一个本来被设计为无害的模型变为有害。

对于目前部署的大模型，Many-shot Jialbreaking攻击的有效性遵循幂律规律。我们这种攻击对最先进的闭源模型以及各种任务的效果非常好。研究结果表明，更长的上下文为大模型攻击提供了更多的选择。

研究发现该攻击有很强的普适性。在不同模型不同任务:(1) Malicious use-cases (2)Malevolent personality evals，(3)Opportunities to insult。不同的对话风格:(1)变换user和assistant的标签（将二者身份倒置） (2)使用不同语言 (3)将user-assitant的标签换为"Question"与"Answer"等等。另外即使提供的上下文与最后想要问的问题为不同的领域同样有效。这让我想到了大模型中经典的prompt chain of thought，在最近的研究中prompt即使将原先的文字换位无意义的字符只要句子结构不改变同样能大幅提升模型的性能。

本篇文章还提出了将Many-shot Jailbreaking与(1)a blackbox, “competing objectives” attack (2) a white-box attack adversarial suffix attack结合提升Many-shot Jailbreaking的效果。结果表明与（1）结合在任何上下文长度都可以提升性能，而与（2）结合在则与shots的数量有关。

对于Many-shot Jailbreaking的效果大致遵循以下趋势：(1)随着shots的数量上升回答出攻击者期望答案的概率按指数上升 (2)更大的模型需要更少的shots即可攻击成功。另外作者提出了一个新的评估指标，即对$-log P(a^(*)|q_1,a_1,...q_n,a_n,q^(*))$也就是对于给定的上下文和问题，模型给出的答案的概率的负对数的期望。这个指标可以用来评估模型的安全性。截距说明了在无上下文中给出不期望答案的概率，斜率表明了给出不期望答案的概率随着上下文的增加而增加的速度。

论文的最后作者提出了一些分防御Many-shot Jailbreaking的方法。

第一种方法使通过SL或RL基于人类和AI的对话对大模型对齐，该方法通过让大模型通过在人和机器的对话中(无害的对话)进行监督学习或强化学习。该方法只能增大曲线的截距。这样使Jailbreaking成功需要更多的shots，该手段加上上下文长度限制可以一定程度防御Many-shot Jailbreaking。然而Many-shot Jailbreaking与其它方法结合如前文提到的black box等将会使这种防御失效。

第二种方法是对数据集进行监督训练微调，该方法通过让大模型在30个MSJ事例进行监督学习。这种方法既能增大曲线的截距也能减小曲线的斜率，但是并不能改变大模型给出不期望答案的趋势，该趋势仍是指数级别的。所以该防御方法仍然是不够有效的。

第三种方法是通过有目标的强化学习进行。与第一种方法类似，只不过在无害的shots中添加一部分有害的问题以诱导大模型说出不期望的答案。若说出不期望的答案则给予惩罚。这种方法可以有效的减小曲线的斜率，但是并不能改变大模型给出不期望答案的趋势。

第四种方法是基于prompt的。可以在输入prompt之前就对其进行修改，使其不会引导大模型给出不期望的答案。这个策略需要大量的测试，本论文仅对可行性进行了探索。ICD方法是在提示之前添加拒绝有害问题的演示，而CWD方法是在用户输入的文本之前和之后添加文本警告打不行不要Jailbreaking。ICD仅将攻击成功率从61\%降至54\%，而CWD降低了2\%的性能。所以在使用该方法之前需要对其的影响有更详细的研究。

## Contribution
- 宋林恺：Many-shot Jailbreaking
- 罗胤玻：Traveling the Silk Road: A measurement analysis of a large anonymous online marketplace